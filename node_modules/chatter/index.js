var all_sockets = null;

exports.set_sockets = function  (sockets) {
  all_sockets = sockets;
};

exports.connect_chatter = function  (config) {
	if (!config.socket.username) {
		config.socket.username = config.username;
	}

	
	
  config.socket.emit('entrance', {message: 'Welcome to the chat room!'});
  all_sockets.emit('entrance', {message: config.socket.username + ' is online.'});

  config.socket.on('disconnect', function  () {
    all_sockets.emit('exit', {message: config.socket.username + ' has disconnected.'});
  });

  config.socket.on('register', function  (data) {
		config.socket.username = data.message;
	    all_sockets.emit('system', 
	{message: config.username + ' is now: ' + config.socket.username});
  });
  
  config.socket.on('color', function  (data) {
		config.socket.color = data.message;
  });
  
  
  config.socket.on('chat', function  (data) {
  
	//var parsed_message = messageParser(data.message);
    all_sockets.emit('chat', {message: config.socket.username + ' says: ' + data.message , color: config.socket.color});
  });
};

exports.failure = function  (socket) {
  socket.emit('error', {message: 'Please log in to the chatroom.'});
};



